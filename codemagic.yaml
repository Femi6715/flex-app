workflows:
  android-build:
    name: Android Build
    environment:
      node: 18
      vars:
        PACKAGE_NAME: "com.amazonflexclone.app"
        EXPO_PROJECT_ID: "AmazonFlexClone"
        CI: 1
        EXPO_TOKEN: "RRFWQu6Vk7QKsvenRaxrbUujXV0c-lCf7JpyU-0S"
    scripts:
      - name: Install Expo & EAS CLI
        script: |
          npm install -g expo-cli eas-cli

      - name: Install dependencies
        script: |
          npm install

      - name: EAS Login
        script: |
          eas whoami || eas login --token=$EXPO_TOKEN

      - name: Configure and Build APK using EAS
        script: |
          # Optional: configure EAS build profile if not already set
          if [ ! -f eas.json ]; then
            eas build:configure
          fi

          # Start the Android build
          eas build --platform android --profile preview --non-interactive

          # Find the APK path in the output
          APK_PATH=$(find . -name "*.apk" | head -n 1)

          echo "APK generated at: $APK_PATH"

          # Create export dir and copy it
          mkdir -p $FCI_EXPORT_DIR/apk
          cp "$APK_PATH" $FCI_EXPORT_DIR/apk/
    artifacts:
      - $FCI_EXPORT_DIR/apk/*.apk
    publishing:
      email:
        recipients:
          - Femi4all@gmail.com
      scripts:
        - name: Build completed
          script: |
            echo "EAS APK built successfully!"
            echo "You can download it from the artifacts section."
